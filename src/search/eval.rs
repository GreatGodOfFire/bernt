use crate::{position::{Position, PieceType, PieceColor}, bitloop};

pub fn eval(pos: &Position) -> i32 {
    let mut eval = 0;

    bitloop!(pos.colors[0] | pos.colors[1] => sq, {
        let piece = pos.piece_at(sq);

        if piece.ty != PieceType::None {
            let sign = if piece.color == pos.side { 1 } else { -1 };
            eval += PSTS[piece.ty][flip(sq, piece.color) as usize] * sign;
        }
    });

    eval
}

#[inline]
pub(super) fn flip(sq: u8, side: PieceColor) -> u8 {
    if side == PieceColor::White {
        sq
    } else {
        sq ^ 56
    }
}

pub(super) const PSTS: [[i32; 64]; 6] = [PAWN, KNIGHT, BISHOP, ROOK, QUEEN, KING];

#[rustfmt::skip]
const PAWN: [i32; 64] = [
       0,    0,    0,    0,    0,    0,    0,    0,
     100,  100,  100,  100,  100,  100,  100,  100,
     100,  100,  100,  100,  100,  100,  100,  100,
     100,  100,  100,  120,  125,  100,  100,  100,
     100,  100,  100,  100,  100,  100,  100,  100,
     100,  100,  100,  100,  100,  100,  100,  100,
     100,  100,  100,  100,  100,  100,  100,  100,
       0,    0,    0,    0,    0,    0,    0,    0,
];
#[rustfmt::skip]
const KNIGHT: [i32; 64] = [
     300,  310,  310,  310,  310,  310,  310,  300,
     310,  320,  320,  320,  320,  320,  320,  310,
     310,  320,  330,  320,  320,  330,  320,  310,
     310,  320,  320,  335,  335,  320,  320,  310,
     310,  320,  320,  335,  335,  320,  320,  310,
     310,  320,  320,  320,  320,  320,  320,  310,
     310,  320,  320,  320,  320,  320,  320,  310,
     300,  310,  310,  310,  310,  310,  310,  300,
];
#[rustfmt::skip]
const BISHOP: [i32; 64] = [
     300,  300,  300,  300,  300,  300,  300,  300,
     300,  330,  330,  330,  330,  330,  330,  300,
     300,  330,  330,  330,  330,  330,  330,  300,
     300,  330,  330,  330,  330,  330,  330,  300,
     300,  330,  330,  330,  330,  330,  330,  300,
     300,  330,  330,  330,  330,  330,  330,  300,
     300,  330,  330,  330,  330,  330,  330,  300,
     300,  300,  300,  300,  300,  300,  300,  300,
];
#[rustfmt::skip]
const ROOK: [i32; 64] = [
     500,  500,  500,  500,  500,  500,  500,  500,
     500,  500,  500,  500,  500,  500,  500,  500,
     500,  500,  500,  500,  500,  500,  500,  500,
     500,  500,  500,  500,  500,  500,  500,  500,
     500,  500,  500,  500,  500,  500,  500,  500,
     500,  500,  500,  500,  500,  500,  500,  500,
     500,  500,  500,  500,  500,  500,  500,  500,
     500,  500,  500,  500,  500,  500,  500,  500,
];
#[rustfmt::skip]
const QUEEN: [i32; 64] = [
     900,  900,  900,  900,  900,  900,  900,  900,
     900,  900,  900,  900,  900,  900,  900,  900,
     900,  900,  900,  900,  900,  900,  900,  900,
     900,  900,  900,  900,  900,  900,  900,  900,
     900,  900,  900,  900,  900,  900,  900,  900,
     900,  900,  900,  900,  900,  900,  900,  900,
     900,  900,  900,  900,  900,  900,  900,  900,
     900,  900,  900,  900,  900,  900,  900,  900,
];
#[rustfmt::skip]
const KING: [i32; 64] = [
       0,    0,   15,    0,   20,    0,   10,   15,
       0,    0,    0,    0,    0,    0,    0,    0,
       0,    0,    0,    0,    0,    0,    0,    0,
       0,    0,    0,    0,    0,    0,    0,    0,
       0,    0,    0,    0,    0,    0,    0,    0,
       0,    0,    0,    0,    0,    0,    0,    0,
       0,    0,    0,    0,    0,    0,    0,    0,
       0,    0,    0,    0,    0,    0,    0,    0,
];
